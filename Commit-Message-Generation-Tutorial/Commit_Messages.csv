Code Change,Commit Message
"diff --git a/deploy_website.sh b/deploy_website.sh
index 70e0e57d5e4..17369068543 100755
--- a/deploy_website.sh
+++ b/deploy_website.sh
@@ -66,7 +66,7 @@ mkdocs gh-deploy
 git checkout gh-pages
 git cherry-pick bb229b9dcc9a21a73edbf8d936bea88f52e0a3ff
 git cherry-pick c695732f1d4aea103b826876c077fbfea630e244
-git push
+git push --set-upstream origin gh-pages
 
 # Delete our temp folder
 cd ..
",Set the upstream when deploying (#7101)
"diff --git a/samples/tlssurvey/build.gradle.kts b/samples/tlssurvey/build.gradle.kts
index b8a78750f9c..bb83f42ebd8 100644
--- a/samples/tlssurvey/build.gradle.kts
+++ b/samples/tlssurvey/build.gradle.kts
@@ -1,7 +1,7 @@
 plugins {
   kotlin(""jvm"")
   application
-  id(""com.google.devtools.ksp"").version(""1.6.21-1.0.6"")
+  id(""com.google.devtools.ksp"").version(""1.7.10-1.0.6"")
 }
 
 application {
",Bump ksp (#7477)
"diff --git a/native-image-tests/build.gradle.kts b/native-image-tests/build.gradle.kts
index 7bbdac6b0d0..fbfe83cd7e5 100644
--- a/native-image-tests/build.gradle.kts
+++ b/native-image-tests/build.gradle.kts
@@ -1,5 +1,4 @@
 import org.apache.tools.ant.taskdefs.condition.Os
-import org.jetbrains.kotlin.incremental.ChangesCollector.Companion.getNnPrivateNames
 
 plugins {
   id(""com.palantir.graal"")
",Native image tests (#7098)
"diff --git a/okhttp-hpacktests/src/test/resources/hpack-test-case b/okhttp-hpacktests/src/test/resources/hpack-test-case
index a5652bc2bc3..8a1406e7d14 160000
--- a/okhttp-hpacktests/src/test/resources/hpack-test-case
+++ b/okhttp-hpacktests/src/test/resources/hpack-test-case
@@ -1 +1 @@
-Subproject commit a5652bc2bc3d2a992f39446369fb004a72e881d4
+Subproject commit 8a1406e7d14bfcb6c046021f13cc15cfb162726d
",Revert hpack-test-case to the previous submodule version (#7056)
"diff --git a/build.gradle b/build.gradle
index b5e8f017c07..d4c4aa8e4ac 100644
--- a/build.gradle
+++ b/build.gradle
@@ -167,6 +167,10 @@ subprojects { project ->
         prefix = ""okhttp3.internal""
         suppress = true
       }
+      perPackageOption {
+        prefix = ""mockwebserver3.internal""
+        suppress = true
+      }
       if (project.file('Module.md').exists()) {
         includes = ['Module.md']
       }
",Don't document mockwebserver3.internal (#6895)
"diff --git a/README.md b/README.md
index 920bbdd9930..082de9e90a7 100644
--- a/README.md
+++ b/README.md
@@ -49,8 +49,7 @@ Post to a Server
 This program posts data to a service. [Full source][post_example].
 
 ```java
-public static final MediaType JSON
-    = MediaType.get(""application/json; charset=utf-8"");
+public static final MediaType JSON = MediaType.get(""application/json"");
 
 OkHttpClient client = new OkHttpClient();
 
",Fixed incorrect JSON media type value in README (#7494)
"diff --git a/build.gradle.kts b/build.gradle.kts
index 51d6318c486..f21f9a97555 100644
--- a/build.gradle.kts
+++ b/build.gradle.kts
@@ -206,7 +206,7 @@ subprojects {
 
   plugins.withId(""com.vanniktech.maven.publish.base"") {
     configure<MavenPublishBaseExtension> {
-      publishToMavenCentral(SonatypeHost.DEFAULT)
+      publishToMavenCentral(SonatypeHost.S01)
       signAllPublications()
       pom {
         name.set(project.name)
",Publish to S01 (#6970)
"diff --git a/.github/workflows/docs.yml b/.github/workflows/docs.yml
index 88764c30570..fe1ea761c8f 100644
--- a/.github/workflows/docs.yml
+++ b/.github/workflows/docs.yml
@@ -18,6 +18,7 @@ jobs:
     permissions:
       checks: write # for actions/upload-artifact
     runs-on: ubuntu-latest
+    if: github.ref == 'refs/heads/master' || contains(github.event.pull_request.labels.*.name, 'documentation')
 
     steps:
       - name: Checkout
",Don't run docs on PR CI without label. (#7590)
"diff --git a/.github/workflows/build.yml b/.github/workflows/build.yml
index a4dd5c2c34a..95cf6395a22 100644
--- a/.github/workflows/build.yml
+++ b/.github/workflows/build.yml
@@ -64,7 +64,7 @@ jobs:
       - name: Run Checks
         uses: gradle/gradle-build-action@v2
         with:
-          arguments: check -x test
+          arguments: check -x test -x jvmTest
 
       - name: Publish Test Report
         if: github.repository == 'square/okhttp' && github.ref == 'refs/heads/master'
",Don't run jvmTest on check CI. (#7589)
"diff --git a/okhttp/src/jvmTest/java/okhttp3/CallTest.kt b/okhttp/src/jvmTest/java/okhttp3/CallTest.kt
index 571abc80b97..47e9b8c7433 100644
--- a/okhttp/src/jvmTest/java/okhttp3/CallTest.kt
+++ b/okhttp/src/jvmTest/java/okhttp3/CallTest.kt
@@ -3092,6 +3092,7 @@ open class CallTest(
     for (i in 0..20) {
       server.enqueue(
         MockResponse()
+          .inTunnel()
           .setResponseCode(407)
           .addHeader(""Proxy-Authenticate: Basic realm=\""localhost\"""")
           .addHeader(""Connection: close"")
",Add a missing inTunnel() call to a proxy test (#7318)
"diff --git a/gradle/wrapper/gradle-wrapper.properties b/gradle/wrapper/gradle-wrapper.properties
index a0f7639f7d3..fbce071a31a 100644
--- a/gradle/wrapper/gradle-wrapper.properties
+++ b/gradle/wrapper/gradle-wrapper.properties
@@ -1,5 +1,5 @@
 distributionBase=GRADLE_USER_HOME
 distributionPath=wrapper/dists
-distributionUrl=https\://services.gradle.org/distributions/gradle-7.2-all.zip
+distributionUrl=https\://services.gradle.org/distributions/gradle-7.3-all.zip
 zipStoreBase=GRADLE_USER_HOME
 zipStorePath=wrapper/dists
",Bump gradle to 7.3 (#6905)
"diff --git a/gradle/wrapper/gradle-wrapper.properties b/gradle/wrapper/gradle-wrapper.properties
index fbce071a31a..ac0b842f198 100644
--- a/gradle/wrapper/gradle-wrapper.properties
+++ b/gradle/wrapper/gradle-wrapper.properties
@@ -1,5 +1,5 @@
 distributionBase=GRADLE_USER_HOME
 distributionPath=wrapper/dists
-distributionUrl=https\://services.gradle.org/distributions/gradle-7.3-all.zip
+distributionUrl=https\://services.gradle.org/distributions/gradle-7.3.2-all.zip
 zipStoreBase=GRADLE_USER_HOME
 zipStorePath=wrapper/dists
","Use Gradle 7.3.2. Log4shell CI mitigation. (#6964)

Gradle 7.3.2 adds dependency constraints to the _build_ classpath to reject known-bad versions of log4j.
There is no log4j dependency in OkHttp for clients, but it's possible that some build plugins use log4j which could affect CI.

See also https://blog.gradle.org/log4j-vulnerability."
"diff --git a/CHANGELOG.md b/CHANGELOG.md
index 60c04427357..075115697d1 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -22,6 +22,7 @@ the fixes or features below, please upgrade.
       url = ""https://cash.app/"".toHttpUrl(),
     )
     ```
+
  *  New: `Response.body` is now non-null. This was generally the case in OkHttp 4.x, but the Kotlin
     type declaration was nullable to support rare cases like the body on `Response.cacheResponse`,
     `Response.networkResponse`, and `Response.priorResponse`. In such cases the body is now
",Attempt to fix changelog formatting
"diff --git a/.github/workflows/build.yml b/.github/workflows/build.yml
index 95cf6395a22..56c26e6cc3e 100644
--- a/.github/workflows/build.yml
+++ b/.github/workflows/build.yml
@@ -64,7 +64,7 @@ jobs:
       - name: Run Checks
         uses: gradle/gradle-build-action@v2
         with:
-          arguments: check -x test -x jvmTest
+          arguments: check -PandroidBuild=true -PgraalBuild=true -x test -x jvmTest -x jsTest
 
       - name: Publish Test Report
         if: github.repository == 'square/okhttp' && github.ref == 'refs/heads/master'
",Compile all on checkjdk11 (#7611)
"diff --git a/okhttp-coroutines/build.gradle.kts b/okhttp-coroutines/build.gradle.kts
index 03b11040c2f..cfe93bc18d9 100644
--- a/okhttp-coroutines/build.gradle.kts
+++ b/okhttp-coroutines/build.gradle.kts
@@ -1,5 +1,5 @@
 import com.vanniktech.maven.publish.JavadocJar
-import com.vanniktech.maven.publish.KotlinJvm
+import com.vanniktech.maven.publish.KotlinMultiplatform
 
 plugins {
   kotlin(""multiplatform"")
@@ -101,5 +101,7 @@ project.applyOsgi(
 )
 
 mavenPublishing {
-  configure(KotlinJvm(javadocJar = JavadocJar.Dokka(""dokkaGfm"")))
+  configure(
+    KotlinMultiplatform(javadocJar = JavadocJar.Dokka(""dokkaGfm""))
+  )
 }
",Fix coroutines publishing (#7150)
"diff --git a/okhttp/build.gradle.kts b/okhttp/build.gradle.kts
index 11ec8c6f2be..5d7ee802c9b 100644
--- a/okhttp/build.gradle.kts
+++ b/okhttp/build.gradle.kts
@@ -41,13 +41,13 @@ kotlin {
       kotlin.srcDir(""$buildDir/generated/sources/kotlinTemplates"")
       dependencies {
         api(Dependencies.okio)
-        api(Dependencies.assertk)
       }
     }
     val commonTest by getting {
       dependencies {
         implementation(Dependencies.kotlinTest)
         implementation(Dependencies.kotlinTestAnnotations)
+        implementation(Dependencies.assertk)
       }
     }
     val nonJvmMain = create(""nonJvmMain"") {
",Move assertk to tests dependencies (#7077)
"diff --git a/okhttp/src/jvmMain/kotlin/okhttp3/Request.kt b/okhttp/src/jvmMain/kotlin/okhttp3/Request.kt
index 632eb514c9b..26e8620235a 100644
--- a/okhttp/src/jvmMain/kotlin/okhttp3/Request.kt
+++ b/okhttp/src/jvmMain/kotlin/okhttp3/Request.kt
@@ -95,6 +95,8 @@ actual class Request internal actual constructor(builder: Builder) {
    * Prior to OkHttp 3.11, this method never returned null if no tag was attached. Instead it
    * returned either this request, or the request upon which this request was derived with
    * [newBuilder].
+   *
+   * @suppress this method breaks Dokka! https://github.com/Kotlin/dokka/issues/2473
    */
   fun tag(): Any? = tag<Any>()
 
","Suppress documentation on Request.tag (#7316)

We've got two overloads that only differ by type arguments.
We need to suppress one to prevent Dokka from crashing.

See: https://github.com/Kotlin/dokka/issues/2473"
"diff --git a/okhttp/src/jvmMain/kotlin/okhttp3/MediaType.kt b/okhttp/src/jvmMain/kotlin/okhttp3/MediaType.kt
index 17d5d81f560..805c3f8103e 100644
--- a/okhttp/src/jvmMain/kotlin/okhttp3/MediaType.kt
+++ b/okhttp/src/jvmMain/kotlin/okhttp3/MediaType.kt
@@ -35,7 +35,7 @@ actual class MediaType internal actual constructor(
 
   /**
    * Returns the charset of this media type, or [defaultValue] if either this media type doesn't
-   * specify a charset, of it its charset is unsupported by the current runtime.
+   * specify a charset, or if its charset is unsupported by the current runtime.
    */
   @JvmOverloads
   fun charset(defaultValue: Charset? = null): Charset? {
",fix typo in MediaType.charset() doc (#7406)
"diff --git a/gradle/libs.versions.toml b/gradle/libs.versions.toml
index d97f20fc3d7..6eb46a48843 100644
--- a/gradle/libs.versions.toml
+++ b/gradle/libs.versions.toml
@@ -47,7 +47,7 @@ gradlePlugin-spotless = ""com.diffplug.spotless:spotless-plugin-gradle:6.12.0""
 guava-jre = ""com.google.guava:guava:31.1-jre""
 hamcrestLibrary = ""org.hamcrest:hamcrest-library:2.2""
 httpClient5 = ""org.apache.httpcomponents.client5:httpclient5:5.2.1""
-jettyClient = ""org.eclipse.jetty:jetty-client:11.0.13""
+jettyClient = ""org.eclipse.jetty:jetty-client:9.4.50.v20221201""
 jnr-unixsocket = ""com.github.jnr:jnr-unixsocket:0.38.19""
 jsoup = ""org.jsoup:jsoup:1.15.3""
 junit = ""junit:junit:4.13.2""
","Downgrade Jetty to 9.4.50.v20221201 (#7599)

This version runs on JDK 1.8."
"diff --git a/deploy_website.sh b/deploy_website.sh
index 17369068543..6b2a54280af 100755
--- a/deploy_website.sh
+++ b/deploy_website.sh
@@ -34,6 +34,10 @@ cd $DIR
   :okhttp-urlconnection:dokkaGfm \
   :okhttp:dokkaGfm
 
+# mkdocs doesn't correctly handle the .md paths in package-list, so post-process.
+# See https://github.com/square/okhttp/issues/7338
+find docs/4.x -name package-list -exec sed -i '' -e 's/index.md$/index.html/' -e 's/\.md$/\.html/' -e '1 s/gfm/html/' -e '2 s/md/html/' {} \;
+
 # Dokka filenames like `-http-url/index.md` don't work well with MkDocs <title> tags.
 # Assign metadata to the file's first Markdown heading.
 # https://www.mkdocs.org/user-guide/writing-your-docs/#meta-data
",Post process md links in package-list files. (#7425)